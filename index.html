<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Learn CMake</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/black.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <style>
      code {
        font-size: 80% !important;
        color: #ba3037;
        background-color: #454545;
        border-radius: 10px;
      }

      pre code {
        font-size: 100% !important;
      }
    </style>

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement('link');
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName('head')[0].appendChild(link);
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <!-- Chapter 0: Introduction -->
        <section>
          <!-- Title -->
          <section data-markdown><textarea data-template>
            ![CMake logo](images/CMake-Logo-and-Text.png)
            <!-- .element style="border: 0; background: None; box-shadow: None" -->

            * [Slide source code](https://github.com/DavidZemon/LearnCMake)
            * [Syllabus](https://github.com/DavidZemon/LearnCMake/wiki/Syllabus)
            * [Labs](https://github.com/DavidZemon/LearnCMake_Labs)
            * Lab Instructions (TODO)
            * [CMake Documentation](https://cmake.org/documentation/) (3.x)
            * [CMake Documentation for v2.8.12](https://cmake.org/cmake/help/v2.8.12/cmake.html)

            Content by [David Zemon](https://david.zemon.name/), May 2017
          </textarea></section>

          <!-- What is CMake? -->
          <section data-markdown><textarea data-template>
            What is CMake?
            --------------

            * Makefile generator
              * Makefile scripts compile code incrementally
              * Define relational dependencies
              * Low-level, granular, unstructured
            * Unit test runner
            * Software packaging orchestrator
          </textarea></section>

          <!-- Why CMake -->
          <section data-markdown><textarea data-template>
            Why CMake
            ---------

            1. Cross-platform
            1. High-level
            1. Support for more than just compiling
               * Unit testing
               * Packaging
               * IDE integration
          </textarea></section>

          <!-- Autotools -->
          <section data-markdown><textarea data-template>
            Shortcomings of Autotools
            -------------------------

            * Not build with Windows/Mac support in mind
            * Configuration language is cryptic
            * Flexibility overload &rarr; Minimal consistency &rarr; No IDE integration
            * Few artifact packaging options
          </textarea></section>

          <!-- SCons -->
          <section data-markdown><textarea data-template>
            Shortcomings of SCons
            ---------------------

            * Potential speed issues
            * Popularity &asymp; Community support and SCons is not as popular
          </textarea></section>

          <!-- Gradle -->
          <section data-markdown><textarea data-template>
            Gradle
            ------

            * Up and coming C++ build system
            * Aiming straight for Maven/NPM-like dependency resolution
            * Holy grail when complete
            * Worse than CMake in the meantime :(
          </textarea></section>
        </section>

        <!-- Chapter 1: "Hello, World!" -->
        <section>
          <!-- Intro -->
          <section data-markdown><textarea data-template>
            Chapter 1
            ---------

            ![Silly hello world image](images/Hello-World.jpg)
            <!-- .element style="border: 0; background: None; box-shadow: None" -->
          </textarea></section>

          <!-- Simple executable -->
          <section data-markdown><textarea data-template>
            Create an Executable
            --------------------

            <pre><code data-trim class="line-numbers cmake">
              cmake_minimum_required(VERSION 2.8)

              project(LearnCMake)

              add_executable(HelloWorld main.cpp)
            </code></pre>

            <pre><code data-trim class="line-numbers Bash">
              $ mkdir bin
              $ cd bin
              $ cmake ..
              $ make
              $ ./HelloWorld
            </code></pre>

            Produces an executable named either `HelloWorld` on *nix or `HelloWorld.exe` on Windows.
          </textarea></section>

          <!-- Add a library -->
          <section data-markdown><textarea data-template>
            Useless Library
            ---------------

            <pre><code data-trim class="line-numbers cmake">
              cmake_minimum_required(VERSION 2.8)

              project(LearnCMake)

              add_library(useless useless.cpp)
            </code></pre>

            * Produces a library named `libuseless.a` on *nix or `useless.lib` on Windows.
            * Can select static, shared, object, or module in the `add_library()` invocation
          </textarea></section>

          <!-- Linking a library.-->
          <section data-markdown><textarea data-template>
            Say "Hello" to a Useless Library
            --------------------------------

            <pre><code data-trim class="line-numbers cmake">
              cmake_minimum_required(VERSION 2.8)

              project(LearnCMake)

              add_library(useless useless/useless.cpp)
              add_executable(HelloWorld hello/main.cpp)
              target_link_libraries(HelloWorld useless)
            </code></pre>

            Use of target names rather than filenames keeps our CMake scripts platform-independent
          </textarea></section>

          <!-- Set some flags.-->
          <section data-markdown><textarea data-template>
            Set Some Compiler Options
            -------------------------

            <pre><code data-trim class="line-numbers cmake">
              cmake_minimum_required(VERSION 2.8)

              project(LearnCMake)

              include_directories("${PROJECT_SOURCE_DIR}/include")
              set(CMAKE_CXX_FLAGS -Wall)

              add_library(useless useless/useless.cpp)
              add_executable(HelloWorld hello/main.cpp)
              target_link_libraries(HelloWorld useless)
            </code></pre>

            * Quotes are an important part of platform-independence (spaces are far more prevelant on Windows)
            * The `CMAKE_CXX_FLAGS` variable sets compiler flags globally for all C++ files
          </textarea></section>

          <!-- CMake `option`s -->
          <section data-markdown><textarea data-template>
            User-Friendly Options
            ---------------------

            <pre><code data-trim class="line-numbers cmake">
              option(WARN_ALL "Throw warnings when you write dumb code" ON)
              if (WARN_ALL)
                set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall")
              endif ()
            </code></pre>

            * The `WARN_ALL` option is now explicitly presented to the user during an invocation of `ccmake`
              (or the CMake GUI on Windows).
            * CMake `option()` function does not provide functionality, only usability
          </textarea></section>

          <!-- CMAKE_BUILD_TYPE -->
          <section data-markdown><textarea data-template>
            Selecting Release/Debug Builds
            ------------------------------

            *`CMAKE_BUILD_TYPE`* has five default options:
            * Release: `-O3 -DNDEBUG`
            * Debug: `-g`
            * RelWithDebInfo: `-O2 -g -DNDEBUG`
            * MinSizeRel: `-Os -DNDEBUG`
            * Fifth option is unset (default) and will not set any flags by default
          </textarea></section>

          <!-- CMAKE_BUILD_TYPE continued... -->
          <section data-markdown><textarea data-template>
            Utilizing `CMAKE_BUILD_TYPE`
            ----------------------------

            <pre><code data-trim class="line-numbers cmake">
              # Enable super extra warnings in debug mode
              set(CMAKE_CXX_DEBUG_FLAGS "${CMAKE_CXX_DEBUG_FLAGS} -Wextra")
            </code></pre>

            * Note that the build type is capitalized in this use case
            * Set flags on a per-build-configuration basis
            * Build configuration types will come up again later in other parts of CMake as well
          </textarea></section>

          <!-- Inheriting from dependencies -->
          <section data-markdown><textarea data-template>
            Set Flags on Targets, Not Folders
            ---------------------------------

            <pre><code data-trim class="line-numbers cmake">
              cmake_minimum_required(VERSION 2.8)

              project(LearnCMake)

              add_library(useless useless/useless.cpp)
              target_include_directories(useless PUBLIC "${PROJECT_SOURCE_DIR}/include")
              target_include_directories(useless PRIVATE "${PROJECT_SOURCE_DIR}/useless")

              add_executable(HelloWorld hello/main.cpp)
              target_link_libraries(HelloWorld useless)
            </code></pre>

            * `PUBLIC` means that `HelloWorld`'s source files will inherit the header search path
            * `PRIVATE` means that `HelloWorld`'s source files will not inherit the header search path
            * `INTERFACE` means that _only_ `HelloWorld` would inherit it, and that `useless` would _not_
          </textarea></section>

          <!-- More inheritance -->
          <section data-markdown><textarea data-template>
            Other Target-Centric Functions
            ------------------------------

            Lots more functions aimed at setting properties on targets:

            * `target_link_libraries`
            * `target_include_directories`
            * `target_compile_options`
            * `target_compile_definitions`
          </textarea></section>

          <!-- Transitive dependencies -->
          <section data-markdown><textarea data-template>
            Transitive Dependencies
            -----------------------

            <pre><code data-trim class="line-numbers cmake">
              add_library(useful  useful/useful.cpp)

              add_library(useless useless/useless.cpp)
              target_link_libraries(useless useful)

              add_executable(HelloWorld hello/main.cpp)
              target_link_libaries(HelloWorld useless)
            </code></pre>

            `HelloWorld` &rarr; `useless` &rarr; `useful`
          </textarea></section>

          <!-- Graphviz -->
          <section data-markdown><textarea data-template>
            BONUS! Graphviz Output
            ----------------------

            <pre><code data-trim class="line-numbers Bash">
              $ mkdir bin
              $ cd bin
              $ cmake --graphviz=graphs/learn ..
              $ ls graphs
              $ cat graphs/learn.HelloWorld
              $ dot -T png graphs/learn.HelloWorld -o HelloWorld.png
            </code></pre>

            * Adding the `--graphviz` option creates "dot" files for every CMake target
            * The "dot" language is very simple to read _and_ write
            * Converting from "dot" files to images is simple with the "dot" command line tool
          </textarea></section>
        </section>

        <!-- Chapter 2: In-Depth Syntax -->
        <section>
          <!-- Intro -->
          <section data-markdown><textarea data-template>
            Chapter 2
            ---------

            ![Syntax erROAR!](images/syntax-error-825x325.jpg)
            <!-- .element style="border: 0; background: None; box-shadow: None" -->

            ### In-Depth Syntax
          </textarea></section>

          <!-- Variable Expansion-->
          <section data-markdown><textarea data-template>
            Variable Expansion
            ------------------

            Variables are expanded similar to shell variables

            <pre><code data-trim class="line-numbers CMake">
              set(FOO   "bar")
              set(UHOH  "FOO")
              set(WTF   "${${UHOH}}")

              message("${FOO}")
              message("${UHOH}")
              message("${WTF}")
            </code></pre>

            Resulting output:

            <span class="fragment fade-in">bar</span><br>
            <span class="fragment fade-in">FOO</span><br>
            <span class="fragment fade-in">bar</span><br>
          </textarea></section>

          <!-- Lists & Loops -->
          <section data-markdown><textarea data-template>
            Lists & Loops
            -------------

            All variables are "strings", but strings can be interpretted as lists

            <pre><code data-trim class="line-numbers CMake">
              set(MEMES "CAT;TREX;NERD")

              message("All memes: ${MEMES}")

              foreach(meme ${MEMES})
                message("Next meme: ${meme}")
              endforeach()
            </code></pre>

            Resulting output:

            <span class="fragment fade-in">All memes: CAT;TREX;NERD</span><br>
            <span class="fragment fade-in">Next meme: CAT</span><br>
            <span class="fragment fade-in">Next meme: TREX</span><br>
            <span class="fragment fade-in">Next meme: NERD</span><br>
          </textarea></section>

          <!-- Lists & Loops Continued... -->
          <section data-markdown><textarea data-template>
            Lists & Loops Continued...
            --------------------------

            <pre><code data-trim class="line-numbers CMake">
              set(POEMS ONE FISH TWO)

              message("All poems: ${POEMS}")

              foreach(poem "${POEMS}")
                message("Next poem? ${poem}")
              endforeach()
            </code></pre>

            Resulting output:

            <span class="fragment fade-in">All poems: ONE;FISH;TWO</span><br>
            <span class="fragment fade-in">Next poem: ONE;FISH;TWO</span><br>
          </textarea></section>

          <!-- If & boolean expressions -->
          <section data-markdown><textarea data-template>
            If-Statement & Boolean Expressions
            ----------------------------------

            <pre><code data-trim class="line-numbers CMake">
              set(THIS_IS_TRUTHY TRUE)  # &asymp; ON, YES, Y, non-zero numbers
              set(THIS_IS_FALSY  FALSE) # &asymp; OFF, NO, N, IGNORE, NOTFOUND, *-NOTFOUND, ""

              if (${THIS_IS_TRUTHY})
                message("Test 1 passed")
              endif ()
              if (THIS_IS_TRUTHY)
                message("Test 2 passed")
              endif ()
              if (NOT ${THIS_IS_FALSY})
                message("Test 3 passed")
              endif ()
              if (NOT THIS_IS_FALSY)
                message("Test 4 passed")
              endif ()
            </code></pre>
          </textarea></section>

          <!-- More boolean expressions -->
          <section data-markdown><textarea data-template>
            Boolean Operator Examples
            -------------------------

            <pre><code data-trim class="line-numbers CMake">
              if (VAR1 OR VAR2)
              if (TARGET another_exe)
              if (EXISTS "${SOME_FILE}")
              if ("${VAR1}" EQUAL "${VAR2}")
              if ("${ACTUAL_VERSION}" VERSION_GREATER "${REQUESTED_VERSION}")
            </code></pre>

            See full list of boolean operators on CMake's `if` documentation
          </textarea></section>
        </section>
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script>
      // More info about config & dependencies:
      // - https://github.com/hakimel/reveal.js#configuration
      // - https://github.com/hakimel/reveal.js#dependencies
      Reveal.initialize({
        width: 1280,
        height: 900,
        previewLinks: true,
        history: true,
        dependencies: [
          {
            src: 'plugin/markdown/marked.js'
          },
          {
            src: 'plugin/markdown/markdown.js'
          },
          {
            src: 'plugin/notes/notes.js',
            async: true
          },
          {
            src: 'plugin/highlight/highlight.js',
            async: true,
            callback: function () {
              hljs.initHighlightingOnLoad();
            }
          },
          {
            src: 'plugin/line-numbers/line-numbers.js'
          }
        ]
      });
    </script>
  </body>
</html>
